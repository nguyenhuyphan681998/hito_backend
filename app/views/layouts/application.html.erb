<!DOCTYPE html>
<html>

<head>
  <title><%= full_title(yield(:title)) %></title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= render 'layouts/shim' %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
</head>

<body>
   <ul>
    <li><%= link_to 'Vietnamese', root_path(locale: :vi) %></li>
    <li><%= link_to 'English', root_path(locale: :en) %></li>
  </ul>
  <div id="fb-root"></div>
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        appId: `<%= ENV['FACEBOOK_APP_ID'] %>`,
        cookie: true,                     // Enable cookies to allow the server to access the session.
        xfbml: true,                     // Parse social plugins on this webpage.
        version: 'v5.0'           // Use this Graph API version for this call.
      });

      FB.getLoginStatus(function (response) {   // Called after the JS SDK has been initialized.
        statusChangeCallback(response);        // Returns the login status.
      });
    }

    function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
      console.log('statusChangeCallback');
      console.log(response);                   // The current login status of the person.
      if (response.status === 'connected') {   // Logged into your webpage and Facebook.
        redirectCallback(response);
      }
    }

    function checkLoginState() {               // Called when a person is finished with the Login Button.
      FB.getLoginStatus(function (response) {   // See the onlogin handler
        statusChangeCallback(response);
      });
    }

    function loginFB() {
      FB.login(function (response) {
        console.log(response);
        if (response.authResponse !== null) {
          var cookie_name = "fbsr_<%= ENV['FACEBOOK_APP_ID'] %>";
          document.cookie = cookie_name + "=" + response.authResponse.signedRequest;
          redirectCallback(response);
        }
      }, {
        scope: 'email,user_link',
        return_scopes: true
      });
    }
    function redirectCallback(response) {
      window.location.replace(`http://localhost:3000/auth/facebook/callback`);
    }
  </script>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js"></script>
  <%= render 'layouts/header' %>

  <div class="container">
    <% flash.each do |message_type, message| %>
    <div class="alert alert-<%= message_type %>"><%= message %></div>
    <% end %>
    <%= yield %>
  </div>
  <%= render 'layouts/footer' %>
</body>

</html>